<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Media API Demo • ridigbio</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Media API Demo">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-87H3DWSJHN"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-87H3DWSJHN');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ridigbio</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/BasicUsage.html">Introduction to ridigbio</a></li>
    <li><a class="dropdown-item" href="../articles/RecordAPIDemo.html">Record API Demo</a></li>
    <li><a class="dropdown-item" href="../articles/MediaAPIDemo.html">Media API Demo</a></li>
    <li><a class="dropdown-item" href="../articles/Fields.html">Fields in ridigbio</a></li>
    <li><a class="dropdown-item" href="../articles/FindTissue.html">Tissue Samples Locator Demo</a></li>
    <li><a class="dropdown-item" href="../articles/ModifiedDataID.html">Identification of Modified Data</a></li>
    <li><a class="dropdown-item" href="../articles/BadCoordinateID.html">Identification of Suspicious Coordinates</a></li>
    <li><a class="dropdown-item" href="../articles/IDDataFlags.html">Identification of Data Flags</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="MediaAPIDemo_files/kePrint-0.0.1/kePrint.js"></script><link href="MediaAPIDemo_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Media API Demo</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/iDigBio/ridigbio/blob/main/vignettes/MediaAPIDemo.Rmd" class="external-link"><code>vignettes/MediaAPIDemo.Rmd</code></a></small>
      <div class="d-none name"><code>MediaAPIDemo.Rmd</code></div>
    </div>

    
    
<p>Code here written by <a href="https://orcid.org/0000-0003-3192-0080" class="external-link">Erica Krimmel</a>.</p>
<div class="section level2">
<h2 id="general-overview">General Overview<a class="anchor" aria-label="anchor" href="#general-overview"></a>
</h2>
<p>In this demo we will cover how to:</p>
<ol style="list-style-type: decimal">
<li>Write a query to search for specimens using
<code>idig_search_media</code>
</li>
<li>Download media records</li>
</ol>
</div>
<div class="section level2">
<h2 id="load-packages">Load Packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load core libraries; install these packages if you have not already</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/iDigBio/ridigbio" class="external-link">ridigbio</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load library for making nice HTML output</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="write-a-query-to-search-for-specimen-records">Write a query to search for specimen records<a class="anchor" aria-label="anchor" href="#write-a-query-to-search-for-specimen-records"></a>
</h2>
<p>First, you need to find all the media records for which you are
interested in downloading media files. Do this using the
<code>idig_search_media</code> function from the ridigbio package, which
allows you to search for media records based on data contained in linked
specimen records, like species or collecting locality. You can learn
more about this function from the <a href="https://github.com/iDigBio/idigbio-search-api/wiki" class="external-link">iDigBio API
documentation</a> and <a href="https://cran.r-project.org/package=ridigbio/ridigbio.pdf" class="external-link">ridigbio
documentation</a>. In this example, we want to search for images of
herbarium specimens of species in the genus <em>Acer</em> that were
collected in the United States.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Edit the fields (e.g. `genus`) and values (e.g. "manis") in `list()` </span></span>
<span><span class="co"># to adjust your query and the fields (e.g. `uuid`) in `fields` to adjust the</span></span>
<span><span class="co"># columns returned in your results; edit the number after `limit` to adjust the</span></span>
<span><span class="co"># number of records you will retrieve images for</span></span>
<span><span class="va">records</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/idig_search_media.html">idig_search_media</a></span><span class="op">(</span>rq <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>genus <span class="op">=</span> <span class="st">"acer"</span>,</span>
<span>       country <span class="op">=</span> <span class="st">"united states"</span><span class="op">)</span>, </span>
<span>       fields <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"uuid"</span>,</span>
<span>                  <span class="st">"accessuri"</span>,</span>
<span>                  <span class="st">"rights"</span>,</span>
<span>                  <span class="st">"format"</span>,</span>
<span>                  <span class="st">"records"</span><span class="op">)</span>,</span>
<span>                limit <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">records</span><span class="op">$</span><span class="va">accessuri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^http://"</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^http://"</span>, <span class="st">""</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span></span>
<span><span class="op">)</span></span>
<span><span class="va">records</span><span class="op">$</span><span class="va">accessuri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"https://mam.ansp.org"</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"https://mam.ansp.org"</span>, <span class="st">"mam.ansp.org"</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span></span>
<span><span class="op">)</span></span>
<span><span class="va">records</span><span class="op">$</span><span class="va">accessuri</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"https://ibss-images.calacademy.org"</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"https://ibss-images.calacademy.org"</span>, <span class="st">"ibss-images.calacademy.org"</span>, <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span><span class="op">)</span>,</span>
<span>  <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The result of the code above is a data frame called
<code>records</code>:</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table table table-striped table-hover table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
uuid
</th>
<th style="text-align:left;">
accessuri
</th>
<th style="text-align:left;">
rights
</th>
<th style="text-align:left;">
format
</th>
<th style="text-align:left;">
records
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
0000b146-6fd2-4a6a-bf78-9e709cc995e9
</td>
<td style="text-align:left;">
mam.ansp.org/image/CM/Fullsize/345/CM345773.jpg
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
8af932f6-24c1-4c9c-9963-10b9b584b632
</td>
</tr>
<tr>
<td style="text-align:left;">
0000b511-67fd-4485-adea-56df8f7e4c66
</td>
<td style="text-align:left;">
<a href="https://sernecportal.org/imglib/seinet/sernec/NCU_VascularPlants/NCU00418/NCU00418780_01.JPG" class="external-link uri">https://sernecportal.org/imglib/seinet/sernec/NCU_VascularPlants/NCU00418/NCU00418780_01.JPG</a>
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
21de8a6f-bb99-4e95-93d9-881fe1b6a73b
</td>
</tr>
<tr>
<td style="text-align:left;">
0000d1cd-8211-45c6-8dfa-bd4a9a001aad
</td>
<td style="text-align:left;">
mam.ansp.org/image/TAWES/Fullsize/0005/TAWES0005954.jpg
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
0a18cad9-2e85-4ae1-8274-68274b058b61
</td>
</tr>
<tr>
<td style="text-align:left;">
000277e9-659b-4e0c-a61b-c5262d33969b
</td>
<td style="text-align:left;">
<a href="https://www.pnwherbaria.org/images/jpeg.php?Image=WTU-V-023351.jpg" class="external-link uri">https://www.pnwherbaria.org/images/jpeg.php?Image=WTU-V-023351.jpg</a>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
ac4d39f6-8775-48ea-b1d1-cd14c6f60e08
</td>
</tr>
<tr>
<td style="text-align:left;">
0002acf9-13d4-4318-a53e-4c00e9361a07
</td>
<td style="text-align:left;">
<a href="https://cch2.org/imglib/cch2/CHSC_VascularPlants/CHSC021/CHSC021794_lg.jpg" class="external-link uri">https://cch2.org/imglib/cch2/CHSC_VascularPlants/CHSC021/CHSC021794_lg.jpg</a>
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
b0d09b22-e30f-4b89-ab03-d4c863b4727a
</td>
</tr>
<tr>
<td style="text-align:left;">
000495be-df5c-4c01-a951-5656a3fe5ef5
</td>
<td style="text-align:left;">
bgbaseserver.eeb.uconn.edu/DATABASEIMAGES/CONN00075691.JPG
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
2642a89e-bcda-4c8c-8b20-3753b37ab990
</td>
</tr>
<tr>
<td style="text-align:left;">
0005475a-c2c9-4908-9a27-ba9e555d0c43
</td>
<td style="text-align:left;">
<a href="https://cdn.floridamuseum.ufl.edu/Herbarium/945bc71c-a736-42e2-8b41-7a00bf9529fe" class="external-link uri">https://cdn.floridamuseum.ufl.edu/Herbarium/945bc71c-a736-42e2-8b41-7a00bf9529fe</a>
</td>
<td style="text-align:left;">
BY-NC
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
197ea7d4-de1f-4c93-ac98-8c81b53fbece
</td>
</tr>
<tr>
<td style="text-align:left;">
00056e02-50b6-4c62-a975-306cc870dd83
</td>
<td style="text-align:left;">
<a href="https://img.cyverse.org/resize?width=4000&amp;url=https://data.cyverse.org/dav-anon/iplant/projects/magnoliagrandiFLORA/images/specimens/MISS0038464/MISS0038464.JPG" class="external-link uri">https://img.cyverse.org/resize?width=4000&amp;url=https://data.cyverse.org/dav-anon/iplant/projects/magnoliagrandiFLORA/images/specimens/MISS0038464/MISS0038464.JPG</a>
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
04764068-999e-4902-b30b-4e1d0d23d214
</td>
</tr>
<tr>
<td style="text-align:left;">
000654a2-02f3-4c14-b28a-7567cb55aa57
</td>
<td style="text-align:left;">
<a href="https://api.idigbio.org/v2/media/793b0495f464a5403db6918811399c1d" class="external-link uri">https://api.idigbio.org/v2/media/793b0495f464a5403db6918811399c1d</a>
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
b8f0b19c-2ea7-4f40-971f-4e92f0f6fd98
</td>
</tr>
<tr>
<td style="text-align:left;">
00068ad5-816c-425e-8e81-8a2f808043e8
</td>
<td style="text-align:left;">
mam.ansp.org/image/PH/Fullsize/00436/PH00436926.jpg
</td>
<td style="text-align:left;">
BY-NC-SA
</td>
<td style="text-align:left;">
image/jpeg
</td>
<td style="text-align:left;">
1ac7a558-1450-4ea4-941e-7aed2d95c768
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="generate-a-list-of-urls">Generate a list of URLs<a class="anchor" aria-label="anchor" href="#generate-a-list-of-urls"></a>
</h2>
<p>Now that we know what media records are of interest to us, we need to
isolate the URLs that link to the actual media files so that we can
download them. In this example, we will demonstrate how to download
files that are cached on the iDigBio server, as well as the original
files hosted externally by the data provider. You likely do not need to
download two sets of images, so can choose to comment out the steps
related to either “_iDigBio” or “_external” depending on your
preference.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Assemble a vector of iDigBio server download URLs from `records`</span></span>
<span><span class="va">mediaurl_idigbio</span> <span class="op">&lt;-</span> <span class="va">records</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>mediaURL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"https://api.idigbio.org/v2/media/"</span>, <span class="va">uuid</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">mediaURL</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assemble a vector of external server download URLs from `records`</span></span>
<span><span class="va">mediaurl_external</span> <span class="op">&lt;-</span> <span class="va">records</span><span class="op">$</span><span class="va">accessuri</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace</a></span><span class="op">(</span><span class="st">"\\?size=fullsize"</span>, <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p>These vectors look like this:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mediaurl_idigbio</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "https://api.idigbio.org/v2/media/0000b146-6fd2-4a6a-bf78-9e709cc995e9"</span></span>
<span><span class="co">##  [2] "https://api.idigbio.org/v2/media/0000b511-67fd-4485-adea-56df8f7e4c66"</span></span>
<span><span class="co">##  [3] "https://api.idigbio.org/v2/media/0000d1cd-8211-45c6-8dfa-bd4a9a001aad"</span></span>
<span><span class="co">##  [4] "https://api.idigbio.org/v2/media/000277e9-659b-4e0c-a61b-c5262d33969b"</span></span>
<span><span class="co">##  [5] "https://api.idigbio.org/v2/media/0002acf9-13d4-4318-a53e-4c00e9361a07"</span></span>
<span><span class="co">##  [6] "https://api.idigbio.org/v2/media/000495be-df5c-4c01-a951-5656a3fe5ef5"</span></span>
<span><span class="co">##  [7] "https://api.idigbio.org/v2/media/0005475a-c2c9-4908-9a27-ba9e555d0c43"</span></span>
<span><span class="co">##  [8] "https://api.idigbio.org/v2/media/00056e02-50b6-4c62-a975-306cc870dd83"</span></span>
<span><span class="co">##  [9] "https://api.idigbio.org/v2/media/000654a2-02f3-4c14-b28a-7567cb55aa57"</span></span>
<span><span class="co">## [10] "https://api.idigbio.org/v2/media/00068ad5-816c-425e-8e81-8a2f808043e8"</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mediaurl_external</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "mam.ansp.org/image/CM/Fullsize/345/CM345773.jpg"                                                                                                                 </span></span>
<span><span class="co">##  [2] "https://sernecportal.org/imglib/seinet/sernec/NCU_VascularPlants/NCU00418/NCU00418780_01.JPG"                                                                    </span></span>
<span><span class="co">##  [3] "mam.ansp.org/image/TAWES/Fullsize/0005/TAWES0005954.jpg"                                                                                                         </span></span>
<span><span class="co">##  [4] "https://www.pnwherbaria.org/images/jpeg.php?Image=WTU-V-023351.jpg"                                                                                              </span></span>
<span><span class="co">##  [5] "https://cch2.org/imglib/cch2/CHSC_VascularPlants/CHSC021/CHSC021794_lg.jpg"                                                                                      </span></span>
<span><span class="co">##  [6] "bgbaseserver.eeb.uconn.edu/DATABASEIMAGES/CONN00075691.JPG"                                                                                                      </span></span>
<span><span class="co">##  [7] "https://cdn.floridamuseum.ufl.edu/Herbarium/945bc71c-a736-42e2-8b41-7a00bf9529fe"                                                                                </span></span>
<span><span class="co">##  [8] "https://img.cyverse.org/resize?width=4000&amp;url=https://data.cyverse.org/dav-anon/iplant/projects/magnoliagrandiFLORA/images/specimens/MISS0038464/MISS0038464.JPG"</span></span>
<span><span class="co">##  [9] "https://api.idigbio.org/v2/media/793b0495f464a5403db6918811399c1d"                                                                                               </span></span>
<span><span class="co">## [10] "mam.ansp.org/image/PH/Fullsize/00436/PH00436926.jpg"</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="download-media">Download media<a class="anchor" aria-label="anchor" href="#download-media"></a>
</h2>
<p>We can use the download URLs that we assembled in the step above to
go and download each media file. For clarity, we will place files in two
different folders, based on whether we downloaded them from the iDigBio
server or an external server. We will name each file based on its unique
identifier.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create new directories to save media files in</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"jpgs_idigbio"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"jpgs_external"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assemble another vector of file paths to use when saving media downloaded </span></span>
<span><span class="co"># from iDigBio</span></span>
<span><span class="va">mediapath_idigbio</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"jpgs_idigbio/"</span>, <span class="va">records</span><span class="op">$</span><span class="va">uuid</span>, <span class="st">".jpg"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assemble another vector of file paths to use when saving media downloaded</span></span>
<span><span class="co"># from external servers; please note that it's probably not a great idea to</span></span>
<span><span class="co"># assume these files are all jpgs, as we're doing here...</span></span>
<span><span class="va">mediapath_external</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"jpgs_external/"</span>, <span class="va">records</span><span class="op">$</span><span class="va">uuid</span>, <span class="st">".jpg"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add a check to deal with URLs that are broken links</span></span>
<span><span class="va">possibly_download.file</span> <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/possibly.html" class="external-link">possibly</a></span><span class="op">(</span><span class="va">download.file</span>, </span>
<span>                                         otherwise <span class="op">=</span> <span class="st">"cannot download"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#"mode" argument (="wb") in the walk function to download.file. </span></span>
<span></span>
<span><span class="co"># Iterate through the action of downloading whatever file is at each</span></span>
<span><span class="co"># iDigBio URL</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">walk2</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">mediaurl_idigbio</span>,</span>
<span>             .y <span class="op">=</span> <span class="va">mediapath_idigbio</span>, <span class="va">possibly_download.file</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Iterate through the action of downloading whatever file is at each</span></span>
<span><span class="co"># external URL</span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">walk2</a></span><span class="op">(</span>.x <span class="op">=</span> <span class="va">mediaurl_external</span>,</span>
<span>             .y <span class="op">=</span> <span class="va">mediapath_external</span>, <span class="va">possibly_download.file</span><span class="op">)</span></span></code></pre></div>
<p>You should now have two folders, each with ten images downloaded from
iDigBio and external servers, respectively. Note that we only downloaded
ten images here for brevity’s sake, but you can increase this using the
<code>limit</code> argument in the first step. Here is an example of one
of the images we downloaded:</p>
<p>[1] “<img src="jpgs_idigbio/0000b146-6fd2-4a6a-bf78-9e709cc995e9.jpg" alt="Herbarium specimen of an Acer species collected in the United States">”</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Francois Michonneau, Matthew Collins, Michelle L. Gaynor, Jesse Bennett.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
